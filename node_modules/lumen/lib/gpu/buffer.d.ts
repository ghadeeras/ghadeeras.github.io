import { ReplaceValues, StrictExclude } from "../utils.js";
import { Device } from "./device.js";
import { DataSegment, Element } from "./types.js";
import { Resource } from "./utils.js";
export type SyncBuffers<D extends DataBufferDescriptors> = ReplaceValues<D, SyncBuffer>;
export declare class SyncBuffer implements Resource {
    readonly gpuBuffer: DataBuffer;
    readonly cpuBuffer: DataView;
    private dirtyRange;
    private constructor();
    get label(): string;
    asBindingResource(binding?: Omit<GPUBufferBinding, "buffer">): GPUBindingResource;
    get<T>(element: Element<T>): T;
    set<T>(element: Element<T>, value: T): void;
    private dirty;
    private clean;
    static instances<D extends DataBufferDescriptors>(device: Device, descriptors: D, labelPrefix?: string): SyncBuffers<D>;
    static instance(device: Device, descriptor: DataBufferDescriptor): SyncBuffer;
}
export interface BaseBuffer extends Resource {
    wrapped: GPUBuffer;
    size: number;
    label: string;
    device: Device;
    destroy(): void;
    asBindingResource(binding?: Omit<GPUBufferBinding, "buffer"> | null): GPUBindingResource;
}
export declare abstract class AbstractBuffer implements BaseBuffer {
    readonly device: Device;
    private _wrapped;
    protected constructor(device: Device, _wrapped: GPUBuffer);
    get wrapped(): GPUBuffer;
    set wrapped(b: GPUBuffer);
    get size(): number;
    get label(): string;
    destroy(): void;
    asBindingResource(binding?: Omit<GPUBufferBinding, "buffer"> | null): GPUBuffer | {
        buffer: GPUBuffer;
        size?: GPUSize64 | undefined;
        offset?: GPUSize64 | undefined;
    };
}
export interface SourceBuffer extends BaseBuffer {
    copy(segment?: DataSegment): DestinationClause<void>;
    set(segment?: DataSegment): BufferWriter;
}
export interface DestinationBuffer extends BaseBuffer {
    copy(segment?: DataSegment): SourceClause<void>;
    get(segment?: DataSegment): BufferReader;
}
export declare class DataBuffer extends AbstractBuffer implements SourceBuffer, DestinationBuffer {
    readonly descriptor: DataBufferDescriptor;
    private constructor();
    copy(segment?: DataSegment): DestinationClause<void> & SourceClause<void>;
    setData(data: DataView): Promise<void>;
    set(bufferSegment?: DataSegment): BufferWriter;
    get(bufferSegment?: DataSegment): BufferReader;
    static instances<D extends DataBufferDescriptors>(device: Device, descriptors: D, labelPrefix?: string): DataBuffers<D>;
    static instance<D extends DataBufferDescriptor>(device: Device, descriptor: D): DataBuffer;
}
export type BufferUsage = StrictExclude<(keyof GPUBufferUsage), "MAP_READ" | "MAP_WRITE" | "COPY_SRC" | "COPY_DST">[];
export type DataBuffers<D extends DataBufferDescriptors> = ReplaceValues<D, DataBuffer>;
export type DataBufferDescriptors = Record<string, DataBufferDescriptor>;
export type DataBufferDescriptor = {
    label?: string;
    usage: BufferUsage;
} & ({
    data: DataView;
    size?: never;
} | {
    size: number;
    data?: never;
});
export declare class ReadBuffer extends AbstractBuffer implements DestinationBuffer {
    private mapper;
    private constructor();
    copy(bufferSegment?: DataSegment): SourceClause<void>;
    get(bufferSegment?: DataSegment): BufferReader;
    static instances<D extends ReadBufferDescriptors>(device: Device, descriptors: D, labelPrefix?: string): ReadBuffers<D>;
    static instance(device: Device, size: number, label?: string): ReadBuffer;
}
export type ReadBuffers<D extends ReadBufferDescriptors> = ReplaceValues<D, ReadBuffer>;
export type ReadBufferDescriptors = Record<string, number>;
export declare class WriteBuffer extends AbstractBuffer implements SourceBuffer {
    readonly data: DataView;
    private mapper;
    private constructor();
    copy(bufferSegment?: DataSegment): DestinationClause<void>;
    set(bufferSegment?: DataSegment): BufferWriter;
    static instances<D extends WriteBufferDescriptors>(device: Device, descriptors: D, labelPrefix?: string): WriteBuffers<D>;
    static instance(device: Device, data: DataView, label?: string): WriteBuffer;
}
export type WriteBuffers<D extends WriteBufferDescriptors> = ReplaceValues<D, WriteBuffer>;
export type WriteBufferDescriptors = Record<string, DataView>;
export declare function copy(segmentSize?: number): SourceClause<DestinationClause<void>> & DestinationClause<SourceClause<void>>;
export type DestinationClause<T> = {
    to: (buffer: DestinationBuffer, offset?: number) => T;
};
export type SourceClause<T> = {
    from: (buffer: SourceBuffer, offset?: number) => T;
};
export type BufferReader = {
    asData: (data?: DataView, offset?: number) => Promise<DataView>;
};
export type BufferWriter = {
    fromData: (data: DataView, offset?: number) => Promise<void>;
};
